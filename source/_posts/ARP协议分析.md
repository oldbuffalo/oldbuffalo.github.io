---
title: ARP协议分析
date: 2019-03-06 20:22:07
tags:
- 网络
- Linux高性能服务器编程
---

## ARP协议工作原理

ARP协议是TCP/IP栈中数据链路层很重要的一个协议，能实现任意网络层地址到任意物理地址的转换，比如ip地址到MAC地址的转换。ARP通信在TCP连接之前就建立完成。

工作原理：主机向自己所在的网络广播一个ARP请求，该请求包含目标机器的网络地址。此网络中的其他极其都将收到这个请求，但只有被请求的目标机器会回应一个ARP应答，其中包含自己的物理地址。

<!-- more -->

## 以太网ARP请求/应答报文详解

![ARP报文](/pic/ARP报文.png)

1.硬件类型字段定义物理地址的类型，值为1表示MAC地址

2.协议类型字段表示要映射的协议地址类型，值为0x800,表示IP地址

3.硬件地址长度字段和协议地址长度字段，单位是字节，对MAC地址来说，长度为6，对IP(v4)地址来说，长度为4

4.操作字段指出4种操作类型：ARP请求（值为1）、ARP应答（值为2）、RARP请求（值为3）、RARP应答（值为4）

5.最后4个字段指定通信双方的以太网地址和IP地址。

## ARP高速缓存

在现实情况中，ARP的工作方式就是，先在ARP缓存中找，找不到了再在局域网上“发帖求助”。也就是说ARP维护一个高速缓存，其中包含经常访问或者最近访问的机器的IP地址和物理地址的映射。

**这样避免了重复的ARP请求，提高了发送数据包的效率**

Linux下可以用arp命令来查看和修改ARP高速缓存

使用 arp　　当没有参数时打印（到屏幕上）当前表中的内容。

![](/pic/arp命令1.png)

arp -a　　　以BSD风格输出ARP缓存中的内容

![](/pic/arp命令1.png)

sudo arp -d  ip　　　　　　　 #删除该ip对应的主机所对应的ARP缓存项

sudo arp -s   ip  MAC 　　　　#添加该ip对应的主机所对应的ARP缓存项

## 使用场景

ARP协议使用场景：网络层使用IP地址寻址一台机器，但是数据链路层使用物理地址来寻址一台机器，因此网络层必须先将目标机器的IP地址转化成物理地址，才能使用数据链路层提供的服务。

RARP协议使用场景：仅用于网络上的某些无盘工作站，因为缺乏存储设备，无盘工作站无法记住自己的IP地址，但它们可以利用网卡上的物理地址来向网络管理者（服务器或网络管理软件）查询自身的IP地址。运行RARP服务的网络管理者通常存有该网络上的所有机器的物理地址到IP地址的映射。





