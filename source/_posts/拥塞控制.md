---
title: 拥塞控制
date: 2018-11-17 23:22:28
tags: 
- TCP
- 网络
---

## 引言

 计算机网络中的带宽、交换结点中的缓存和处理机等，都是网络的资源。在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络的性能就会变坏。这种情况就叫做拥塞。

拥塞控制就是防止过多的数据注入到网络中，避免路由器或数据链路过载。(网络中的数据是经过路由器进行转发)

拥塞控制是一个全局性的过程，面对的是整个网络，不用于端到端的流量控制。

拥塞控制的作用就是提高网络利用率，降低丢包率，并保证网络资源对每条数据流的公平性。

<!-- more -->

## 慢启动和拥塞避免

发送端维护一个拥塞窗口(cwnd)，大小取决于网络的拥塞程度动态地变化。

慢启动:TCP模块一开始发送数据时并不知道网络的实际情况，先探测一下网络的拥塞情况。

下面的实例以报文数量做演示，实际上是以字节为单位。

![慢开始](/pic/慢开始.png)

注意:慢启动阶段接收端没确认一次，拥塞窗口大小就加1

1.第一次发送端发送M1，接收端确认了
2.第二次由于接收端确认了M1，因此拥塞窗口加1，发送M2和M3
3.第三次由于接收端确认了M2和M3，拥塞窗口加2，变成4，发送M4-M7

由此可见，慢启动阶段传输轮次每加一，拥塞窗口数就加倍，呈乘法增长。

但是为了防止拥塞窗口增长过大引起网络拥塞，因此需要一个慢启动的门限值(ssthresh)
一旦超过这个门限值，就该用拥塞避免算法。
拥塞避免:让拥塞窗口缓慢增长，即每经过一个往返时间RTT(一轮)，拥塞窗口只加1，呈加法增长。

无论是在慢启动阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞（其根据就是没有收到确认，虽然没有收到确认可能是其他原因的分组丢失，但是因为无法判定，所以都当做拥塞来处理），就把慢启动门限设置为出现拥塞时的发送窗口大小的一半。然后把拥塞窗口设置为1，执行慢启动算法。

![慢开始拥塞避免](/pic/慢开始和拥塞避免.png)

## 快重传和快恢复

快重传要求接收方在收到一个失序的报文段后就立即发出重复确认（为的是使发送方及早知道有报文段没有到达对方）而不要等到自己发送数据时捎带确认。快重传算法规定，发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段，而不必继续等待设置的重传计时器时间到期。

![快重传](/pic/快重传.png)

快重传还配合着快恢复。

快重传一旦触发，意味着出现丢包，但考虑到还能收到几个重复地确认包，因此不是网络拥塞造成的，所以不执行慢启动，而是执行快恢复。

快恢复:1.当发送方连续收到三个重复确认时，就执行“乘法减小”算法，ssthresh变成当时拥塞窗口的一半
　　　 2.将窗口设置为ssthresh的大小，然后执行拥塞避免算法。

![快恢复](/pic/快恢复.png)



## 扩展

在Linux下，拥塞控制算法有多种实现，比如reno算法、vegas算法、cubic算法等，基本都实现了上述四个部分。

/proc/sys/net/ipv4/tcp_congestion_control文件中指示了机器当前使用的拥塞控制算法。







