---
title: 进程
date: 2019-03-15 17:44:38
tags:
- 进程
- 操作系统
---

最近面了鹅厂实习的提前批，复试凉凉，还是挂在操作系统。

所以决定恶补一波，跟着工大孙志岗老师的视频和《操作系统之哲学原理》重新学一下操作系统。

## 操作系统

操作系统的作用是管理计算机上的各种资源，在硬件和软件之间起到桥梁的作用。

资源主要包括CPU、内存、文件系统、I/O等。

<!--more-->

## 进程

针对CPU管理，操作系统使用的是进程模型，也就是说操作系统用进程来控制CPU进行计算。

进程是为了在CPU上实现多道编程而出现的概念，也就是通过并发来提高系统利用率，同时缩短系统响应时间。

进程：执行中的程序，也就是说一个程序加载到内存中就变成了进程。

每一个进程都占用一片内存空间，那么如何让多个进程共享同一个物理内存而不发生冲突，这就涉及到[内存管理](http://striveben.top/2019/03/15/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/)

如何将CPU在多个进程之间进行切换，这就涉及进程实现的另一个问题，[CPU调度](http://striveben.top/2019/03/15/CPU%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95/)

#### 进程控制

linux在操作系统通过进程控制块(PCB)来管理进程,实际上就是一个task_struct结构体。

在我的虚拟机上，它保存在/usr/src/linux-headers-4.4.0-21/include/linux/sched.h文件中

通过/ str(待查找的字符串)可以找到task_struct结构体的定义，保存了进程所有的信息。

单个进程是通过PCB来管理的，那么操作系统又是怎么管理所有进程的PCB的呢？(有待查证)

维护所有进程的队列、就绪队列、设备队列(每个I/O设备都有一个队列，进程阻塞在对应IO的队列上)

那么队列是用什么数据结构实现的呢？

由于各个队列之间需要频繁的添加、删除操作，因此用链表实现似乎更适合。

但是，在操作系统底层用的一个大数组，然后用指针指向一个结构体存储所有就绪队列的编号，用指针指向一个结构体存储设备队列的编号。

为什么要数组呢？

1.访问比较快速，链表遍历是一个很耗时的操作

2.局部性原理(cache)，链表遍历可能造成cache一直刷新，效率低，局部性原理和数组比较般配

3.缺点：有空间的闲置、空洞，造成内存浪费，但是如今硬件条件更好了。

#### 进程在内存中的模型

虚拟地址空间

32位系统  0-4G

64位系统  0-256TB

以32位为例

![](/pic/linux进程内存分布.png)

Linux 使用虚拟地址空间，大大增加了进程的寻址空间，由低地址到高地址分别为： 

- 只读段：该部分空间只能读，不可写；(包括：代码段、rodata 段(C常量字符串和#define定义的常量) )
- 数据段：保存全局变量、静态变量的空间；
- 堆 ：就是平时所说的动态内存， malloc/new 大部分都来源于此。其中堆顶的位置可通过函数 brk 和 sbrk 进行动态调整。 
- 文件映射区域 ：如动态库、共享内存等映射物理空间的内存，一般是 mmap 函数所分配的虚拟地址空间。
- 栈：用于维护函数调用的上下文空间，一般为 8M ，可通过 ulimit –s 查看。 
- 内核虚拟空间：用户代码不可见的内存区域，由内核管理(页表就存放在内核虚拟空间)

其中 0x08048000~0xbfffffff 是用户空间，0xc0000000~0xffffffff 是内核空间，包括内核代码和数据、与进程相关的数据结构（如页表、内核栈）等。另外，%esp 执行栈顶，往低地址方向变化；brk/sbrk 函数控制堆顶_edata往高地址方向变化。

