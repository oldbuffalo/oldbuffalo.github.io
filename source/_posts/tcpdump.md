---
title: tcpdump
date: 2019-03-06 21:18:10
tags:
- 网络
- 常用工具
-  Linux高性能服务器编程
---

码上一些tcpdump的选项，方便自己查看。

-n　使用IP地址表示主机，而不是主机名；使用数字表示端口号，而不是服务名称

-i　  指定要监听的网卡接口。"-i any"表示抓取所有网卡接口上的数据包

-v　 输出一个稍微详细的信息，例如，显示IP数据包中的TTL和TOS信息

-t　  不打印时间戳

-e　  显示以太网帧头部信息

-c　   仅抓取指定数量的数据包

-x　   以十六进制数显示数据包的内容，但不显示包中以太网帧的头部信息

-X　   与-x类似，不过还打印每个十六进制字节对应的ASCII字符

-XX　 与-X相同，不过还打印以太网帧的头部信息

-s 　   设置抓包时的抓取长度。4.0版本之前默认68字节，4.0之后的版本默认65535

-S　　以绝对值来显示TCP报文段的序号,而不是相对值

-w　   将tcpdump的输出以特殊的格式定向到某个文件

-r　    从文件读取数据包信息并显示之

除了使用选项之外，tcpdump还支持用表达式来进一步过滤数据包。

表达式操作数分为3种：类型、方向、协议

- 类型，解释其后面紧跟着的参数的含义。支持的类型有host、net、port和portrange

  比如要抓取整个1.2.3.0/255.255.255.0网络上的数据包，可以用

  tcpdump net 1.2.3.0/24

- 方向，src指定数据包的发送端，dst指定数据包的目的端

  比如要抓取进入端口1234的数据包

  tcpdump dst port 1234

- 协议，指定目标协议，比如要抓取所有ICMP数据包

  tcpdump icmp

可以用逻辑操作符组织上面的操作数  

支持  and(&&) 、or(||)、not(!)

例如抓取来自主机1.2.3.4，目标端口是1234或者2048的数据包

tcpdump 'src 1.2.3.4 and (dst port 1234 or 2048)'

**需要注意的是：在使用括号进行分组的时候，需要用单引号将其括住或者用'\'进行转义，避免被shell所解释**



直接使用数据包中的部分协议字段的内容来过滤数据包

例如，只抓取TCP同步报文段

tcpdump 'tcp[13] & 2 != 0' 　　　　＃TCP头部的第14个字节的第二个位正是SYN

tcpdump 'tcp[tcpflags] & tcp-syn != 0' 